<!-- Do not edit this file. It is automatically generated by API Documenter. -->

[Home](./index.md) &gt; [@thi.ng/hdom](./hdom.md) &gt; [HDOMImplementation](./hdom.hdomimplementation.md)

## HDOMImplementation interface

This interface defines the underlying target update operations used by `diffTree()` and `createDOM()`<!-- -->. It allows [@thi.ng/hdom](./hdom.md) to be used as general purpose tree definition &amp; differential update mechanism, rather than being restricted to only work with an HTML DOM. See [DEFAULT\_IMPL](./hdom.default_impl.md) for the default implementations dealing with the latter. Note: Depending on use case and tree configuration, not all of these methods are required.

Custom element-local implementations can also be provided via the special `__impl` hdom element/component attribute. In this case the element itself and all of its children will be processed with those custom operations.

<b>Signature:</b>

```typescript
export interface HDOMImplementation<T> 
```

## Methods

|  Method | Description |
|  --- | --- |
|  [createElement(parent, tag, attribs, child)](./hdom.hdomimplementation.createelement.md) | Creates a new element of type <code>tag</code> with optional <code>attribs</code>. If <code>parent</code> is not <code>null</code>, the new element will be inserted as child at given <code>insert</code> index. If <code>child</code> is missing, the element will be appended to the <code>parent</code>'s list of children. Returns new target DOM node.<!-- -->In the default implementation, if <code>tag</code> is a known SVG element name, the new element will be created with the proper SVG XML namespace. |
|  [createTextElement(parent, content)](./hdom.hdomimplementation.createtextelement.md) | Creates and appends the given <code>content</code> as text child node to <code>parent</code> in the target. |
|  [createTree(opts, parent, tree, child, init)](./hdom.hdomimplementation.createtree.md) | Realizes the given hdom tree in the target below the <code>parent</code> node, e.g. in the case of the browser DOM, creates all required DOM elements encoded by the given hdom tree. |
|  [diffTree(opts, parent, prev, curr, child)](./hdom.hdomimplementation.difftree.md) | Takes an <code>HDOMOpts</code> options object, a <code>parent</code> element and two normalized hiccup trees, <code>prev</code> and <code>curr</code>. Recursively computes diff between both trees and applies any necessary changes to reflect <code>curr</code> tree, based on the differences to <code>prev</code>, in target (browser DOM when using the <code>DEFAULT_IMPL</code> implementation).<!-- -->All target modification operations are delegated to the given implementation. <code>diffTree()</code> merely manages which elements or attributes need to be created, updated or removed and this NEVER involves any form of tracking of the actual underlying target data structure (e.g. the real browser DOM). hdom in general and <code>diffTree()</code> specifically are stateless. The only state available is implicitly defined by the two trees given (prev / curr).<!-- -->Implementations MUST check for the presence of the <code>__impl</code> control attribute on each branch. If present AND different than the current implementation, the latter MUST delegate to the <code>diffTree()</code> method of the specified implementation and not descent into that branch further itself.<!-- -->Furthermore, if (and only if) an element has the <code>__diff</code> control attribute set to <code>false</code>, then:<!-- -->1) Computing the difference between old &amp; new branch MUST be skipped 2) The implementation MUST recursively call any <code>release</code> life cycle methods present anywhere in the current <code>prev</code> tree (branch). The recursive release process itself is implemented by the exported <code>releaseDeep()</code> function in <code>diff.ts</code>. Custom implementations are encouraged to reuse this, since that function also takes care of handling the <code>__release</code> attrib: if the attrib is present and set to false, <code>releaseDeep()</code> will not descend into the branch any further. 3) Call the current implementation's <code>replaceChild()</code> method to replace the old element / branch with the new one. |
|  [getChild(parent, i)](./hdom.hdomimplementation.getchild.md) | Retrieves child of <code>parent</code> node at index <code>i</code>. |
|  [getElementById(id)](./hdom.hdomimplementation.getelementbyid.md) | Attempts to find an element with the given <code>id</code> attribute in the implementation's tree. In the default implementation this is merely delegated to <code>document.getElementById()</code>. |
|  [hydrateTree(opts, parent, tree, child)](./hdom.hdomimplementation.hydratetree.md) | Takes a target root element and normalized hdom tree, then walks tree and initializes any event listeners and components with life cycle <code>init</code> methods. Assumes that an equivalent "DOM" (minus listeners) already exists when this function is called. Any other discrepancies between the pre-existing DOM and the hdom tree might cause undefined behavior.<!-- -->Implementations MUST check for the presence of the <code>__impl</code> control attribute on each branch. If given, the current implementation MUST delegate to the <code>hydrateTree()</code> method of the specified implementation and not descent into that branch further itself. |
|  [normalizeTree(opts, tree)](./hdom.hdomimplementation.normalizetree.md) | Normalizes given hdom tree, expands Emmet-style tags, embedded iterables, component functions, component objects with life cycle methods and injects <code>key</code> attributes for <code>diffTree()</code> to later identify changes in nesting order. During normalization any embedded component functions are called with the given (optional) user <code>ctx</code> object as first argument. For further details of the default implementation, please see <code>normalizeTree()</code> in <code>normalize.ts</code>.<!-- -->Implementations MUST check for the presence of the <code>__impl</code> control attribute on each branch. If given, the current implementation MUST delegate to the <code>normalizeTree()</code> method of the specified implementation and not descent into that branch further itself.<!-- -->Furthermore, if (and only if) an element has the <code>__normalize</code> control attrib set to <code>false</code>, the normalization of that element's children MUST be skipped.<!-- -->Calling this function is a prerequisite before passing a component tree to <code>diffTree()</code>. Recursively expands given hiccup component tree into its canonical form:
```
["tag", { attribs }, ...body]

```
- resolves Emmet-style tags (e.g. from <code>div#id.foo.bar</code>) - adds missing attribute objects (and <code>key</code> attribs) - merges Emmet-style classes with additional <code>class</code> attrib values (if given), e.g. <code>[&quot;div.foo&quot;, { class: &quot;bar&quot; }]</code> =<!-- -->&gt; <code>[&quot;div&quot;, {class: &quot;bar foo&quot; }]</code> - evaluates embedded functions and replaces them with their result - calls the <code>render</code> life cycle method on component objects and uses result - consumes iterables and normalizes their individual values - calls <code>deref()</code> on elements implementing the <code>IDeref</code> interface and uses returned results - calls <code>toHiccup()</code> on elements implementing the <code>IToHiccup</code> interface and uses returned results - calls <code>.toString()</code> on any other non-component value and by default wraps it in <code>[&quot;span&quot;, x]</code>. The only exceptions to this are: <code>button</code>, <code>option</code>, <code>textarea</code> and SVG <code>text</code> elements, for which spans are never created.<!-- -->Additionally, unless the <code>keys</code> option is explicitly set to false, an unique <code>key</code> attribute is created for each node in the tree. This attribute is used by <code>diffTree</code> to determine if a changed node can be patched or will need to be moved, replaced or removed.<!-- -->In terms of life cycle methods: <code>render</code> should ALWAYS return an array or another function, else the component's <code>init</code> or <code>release</code> fns will NOT be able to be called. E.g. If the return value of <code>render</code> evaluates as a string or number, it should be wrapped as <code>[&quot;span&quot;, &quot;foo&quot;]</code> or an equivalent wrapper node. If no <code>init</code> or <code>release</code> methods are used, this requirement is relaxed.<!-- -->See <code>normalizeElement</code> (normalize.ts) for further details about the canonical element form. |
|  [removeAttribs(element, attribs, prevAttribs)](./hdom.hdomimplementation.removeattribs.md) | Removes given <code>attribs</code> from target <code>element</code>. The attributes from the previous tree are provided for reference (e.g. to be able to remove DOM event listeners). |
|  [removeChild(parent, i)](./hdom.hdomimplementation.removechild.md) | Removes the child of <code>parent</code> at index <code>i</code> in the target. |
|  [replaceChild(opts, parent, child, newTree, init)](./hdom.hdomimplementation.replacechild.md) | A (potentially) optimized version of these 2 operations in sequence:
```
impl.removeChild(parent, child);
impl.createTree(parent, child, newTree);

```
 |
|  [setAttrib(element, id, value, attribs)](./hdom.hdomimplementation.setattrib.md) | Sets the given attribute <code>id</code> to new <code>value</code>. Note: <code>value</code> itself can be a function and if so, the default behavior is to call this function with the also provided <code>attribs</code> object to allow it to produce a derived value. See <code>setAttrib()</code> (dom.ts) for details. |
|  [setContent(element, value)](./hdom.hdomimplementation.setcontent.md) | Sets target <code>element</code>'s text / body content. Note: In the default browser DOM implementation, this will implicitly remove any existing child elements in the target. In practice this function is only applied to <code>[&quot;span&quot;]</code> elements, since (by default) any body content is automatically wrapped in such by <code>normalizeTree()</code>. |

