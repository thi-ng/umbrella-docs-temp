<!-- Do not edit this file. It is automatically generated by API Documenter. -->

[Home](./index.md) &gt; [@thi.ng/hdom](./hdom.md) &gt; [HDOMImplementation](./hdom.hdomimplementation.md) &gt; [normalizeTree](./hdom.hdomimplementation.normalizetree.md)

## HDOMImplementation.normalizeTree() method

Normalizes given hdom tree, expands Emmet-style tags, embedded iterables, component functions, component objects with life cycle methods and injects `key` attributes for `diffTree()` to later identify changes in nesting order. During normalization any embedded component functions are called with the given (optional) user `ctx` object as first argument. For further details of the default implementation, please see `normalizeTree()` in `normalize.ts`<!-- -->.

Implementations MUST check for the presence of the `__impl` control attribute on each branch. If given, the current implementation MUST delegate to the `normalizeTree()` method of the specified implementation and not descent into that branch further itself.

Furthermore, if (and only if) an element has the `__normalize` control attrib set to `false`<!-- -->, the normalization of that element's children MUST be skipped.

Calling this function is a prerequisite before passing a component tree to `diffTree()`<!-- -->. Recursively expands given hiccup component tree into its canonical form:

```
["tag", { attribs }, ...body]

```
- resolves Emmet-style tags (e.g. from `div#id.foo.bar`<!-- -->) - adds missing attribute objects (and `key` attribs) - merges Emmet-style classes with additional `class` attrib values (if given), e.g. `["div.foo", { class: "bar" }]` =<!-- -->&gt; `["div", {class: "bar foo" }]` - evaluates embedded functions and replaces them with their result - calls the `render` life cycle method on component objects and uses result - consumes iterables and normalizes their individual values - calls `deref()` on elements implementing the `IDeref` interface and uses returned results - calls `toHiccup()` on elements implementing the `IToHiccup` interface and uses returned results - calls `.toString()` on any other non-component value and by default wraps it in `["span", x]`<!-- -->. The only exceptions to this are: `button`<!-- -->, `option`<!-- -->, `textarea` and SVG `text` elements, for which spans are never created.

Additionally, unless the `keys` option is explicitly set to false, an unique `key` attribute is created for each node in the tree. This attribute is used by `diffTree` to determine if a changed node can be patched or will need to be moved, replaced or removed.

In terms of life cycle methods: `render` should ALWAYS return an array or another function, else the component's `init` or `release` fns will NOT be able to be called. E.g. If the return value of `render` evaluates as a string or number, it should be wrapped as `["span", "foo"]` or an equivalent wrapper node. If no `init` or `release` methods are used, this requirement is relaxed.

See `normalizeElement` (normalize.ts) for further details about the canonical element form.

<b>Signature:</b>

```typescript
normalizeTree(opts: Partial<HDOMOpts>, tree: any): any[];
```

## Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  opts | <code>Partial&lt;HDOMOpts&gt;</code> |  |
|  tree | <code>any</code> |  |

<b>Returns:</b>

`any[]`

